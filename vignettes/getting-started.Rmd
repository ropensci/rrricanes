---
title: "Getting Started"
author: "Tim Trice"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(dplyr)
library(Hurricanes)
```

## General Introduction

`Hurricanes` is intended to give easy access to hurricane archives. In short, it is a web-scraping tool that parses the National Hurricane Center's (NHC) archives to get storm data. 

At this point, data is only available back to 1998. 

There are two basins which data is available: north Atlantic ("AL") and northeastern Pacific ("EP"). The northeastern Pacific basin typically covers from the west coast of North America to -140&deg; longitude (140&deg;W). The Central Pacific Hurricane Center (CPHC) covers the north Pacific from -140&deg; to -180&deg;. 

The NHC will stop issuing advisories once a storm crosses -140&deg; where the CPHC takes over. However, I cannot rule out that some storms that have crossed this "boundary" or even developed in CPHC waters will not exist in records retrieved.

On a semi-related note. In some instances (such as Hurricane Otto, 2016) a storm may cross from the Atlantic to Pacific ocean (and even vice versa, though rare). When this happens the storm is given a new name once it emerges into the Pacific ocean. However, if a storm crosses -140&deg; longitude it retains it's name.

Lastly, it is possible a storm will develop at the end of the year and continue to exist into the next year. I am not aware if those storms will exist in this package as of this time. However, generally the storm should be listed in the archives of the year it developed. 

## Get Storms

By default, `get_storms` will return all storms that have developed for the current year in both basins. If no storms have developed, an error will be generated. For this example, we'll use 2016.

```{r}
head(get_storms(year = 2016), n = 5L)
```

It returns a dataframe with four variables:

  * `Year` Year the storm developed
  * `Name` Name of the storm and highest classification. If the greatest strength a storm became was tropical storm then `Name` will be "Tropical Storm..."; hurricane as "Hurricane...", etc.
  * `Basin` "AL" for north Atlantic, "EP" for northeastern Pacific.
  * `Link` URL to the storm's archive pages.

There are two parameters that can be passed to `get_storms`:

  * `year` Any 4-digit year including and after 1998
  * `basin` "AL" or "EP"

```{r}
get_storms(year = 2015, basin = "AL")
```

You can also gather multiple years.

```{r}
get_storms(year = 2014:2015, basin = "EP")
```

Notice `Name` is inconsistent in regards to casing. For example, "Hurricane ODILE". In earlier years `Name` will be all uppercase characters, e.g., "HURRICANE ODILE". You can correct this with `toproper()`.

```{r}
toproper("Hurricane ODILE")
toproper("HURRICANE ODILE")
```

## Getting Storm Data

Once you have a list of storms we use that dataframe to help collect the storm data. For the following examples I'll use Tropical Storm Charley from 1998 since it was short-lived.

```{r}
al.1998.charley <- get_storms(year = 1998, basin = "AL") %>% 
  filter(Name == "TROPICAL STORM CHARLEY")
```

### Forecast/Advisory Products (`fstadv`)

Forecast/Advisory products contain the meat of data for a particular storm at a particular time. Other text products contain general information, some of which can be parsed. But if you want accurate details of a storm, use these products.

`fstadv` is the term used in functions and names of dataframes for these products. 

The function `get_storm_data` is what we will use to get only Forecast/Advisory data for Charley. 

```{r, eval = FALSE}
get_storm_data("fstadv", link = al.1998.charley %>% .$Link)
```

The `link` parameter can be one link or a vector of links. 

Now, in our global environment we have a dataframe named `fstadv`.

```{r}
head(fstadv)
```

You can view the definitions for each of the variables in `?fstadv`.

#### Using Name and Key

The `Name` of a storm can change. Generally speaking when a storm develops it is a tropical depression and is given as a cardinal number; for example, Tropical Depression One. For eastern Pacific storms the cardinal number would be appended with a dash followed by the letter 'E' capitalized. So Tropical Depression One-E would be the first storm that developed in the eastern Pacific.

Only when a storm reaches tropical storm strength is it given a name and retains that name for the duration of it's lifetime. 

As you may have guessed, `Name` is not reliable to use as a foreign key tying in the various dataframe this project will produce. For that you will use `Key`.

`Key` is formatted slightly differently depending on the year. For our current example, Charley, the `Key` is 'AL0398'. In later years `Key` will be eight digits long, like 'AL032008'.

  * **AL|EP** Basin the storm is located in.
  * **[:digit:]{2}** Number of the storm for the year, left-padded, if necessary, with a 0
  * **[:digit:]{2}[:digit:]{4}** Year the storm developed in either \%y or \%Y format.

#### Custom name for the returned dataframe

You may not want the `fstadv` dataframe returned named as `fstadv`. For example, if you are working multiple storms there may be a reason you want to keep them separated. You can pass a list to the `names` parameter.

So let's say I want the forecast/advisory data for Charley but I want the dataframe to be named `al.1998.charley.fstadv`.

```{r}
get_storm_data("fstadv", 
               names = list("fstadv" = "al.1998.charley.fstadv"), 
               link = al.1998.charley %>% .$Link)
```

### Other Available Products

There are several products you can retrieve for a specific storm. See `get_storm_data` for a more detailed description.

  * discus Storm discussions
  * fstadv Forecast/Advisory
  * posest Position Estimates
  * public Public Advisory
  * prblty Strike Probabilities
  * update Cyclone updates
  * wndprb Wind probabilities

Some notes about these products. Not every storm will have every product. There are only three products that should exist for every storm: discus, fstadv and one or the other of prblty and wndprb. The probability products were changed between the 2005 and 2006 hurricane seasons; prblty prior to the former and wndprb after the latter.

At this time the products (other than fstadv) are not parsed beyond the header (which contains the Name, Key, Datetime info); only the content of the product is returned. 

There is valuable information in each. However, I have not yet taken the time to extract the data. That will come in later revisions. 

For example, you can get issued watches and warnings from public content. You can get technical information of the storm in the discus products; satellite presentation, forecast model tendencies, etc.

There is also much more information in the fstadv products that can be extracted. That is the next priority.